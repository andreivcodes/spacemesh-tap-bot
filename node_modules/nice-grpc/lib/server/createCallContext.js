"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createCallContext = void 0;
const nice_grpc_common_1 = require("nice-grpc-common");
const node_abort_controller_1 = __importDefault(require("node-abort-controller"));
const convertMetadata_1 = require("../utils/convertMetadata");
/** @internal */
function createCallContext(call) {
    const header = (0, nice_grpc_common_1.Metadata)();
    const trailer = (0, nice_grpc_common_1.Metadata)();
    const abortController = new node_abort_controller_1.default();
    if (call.cancelled) {
        abortController.abort();
    }
    else {
        call.on('cancelled', () => {
            abortController.abort();
        });
    }
    return {
        metadata: (0, convertMetadata_1.convertMetadataFromGrpcJs)(call.metadata),
        peer: call.getPeer(),
        header,
        sendHeader() {
            call.sendMetadata((0, convertMetadata_1.convertMetadataToGrpcJs)(header));
        },
        trailer,
        signal: abortController.signal,
    };
}
exports.createCallContext = createCallContext;
//# sourceMappingURL=createCallContext.js.map